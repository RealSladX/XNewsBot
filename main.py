from crawler import curate_tech_news, soup_crawl
from approval import send_approval_email, send_test_email
import json
import nltk
from database import init_db, show_top_articles
import time
from poster import (
    generate_post_text,
    search_image_pixabay,
    google_image_search,
    download_image,
)
from newspaper import popular_urls

# Download NLTK data for keyword extraction
with open("config.json", "r") as f:
    config = json.load(f)


x_keys = [
    config["x_api_credentials"]["consumer_key"],
    config["x_api_credentials"]["consumer_secret"],
    config["x_api_credentials"]["access_token"],
    config["x_api_credentials"]["access_token_secret"],
]

rss_urls = [
    "https://taskandpurpose.com/feed/",
    "https://www.army-technology.com/feed/",
    "https://www.nasa.gov/feed/",
    "https://www.nasa.gov/news-release/feed/",
    "https://spacenews.com/feed/",
    "https://www.nasa.gov/technology/feed/",
    "https://www.defensenews.com/arc/outboundfeeds/rss/category/air/?outputType=xml",
    "https://www.defensenews.com/arc/outboundfeeds/rss/category/land/?outputType=xml",
    "https://www.defensenews.com/arc/outboundfeeds/rss/category/naval/?outputType=xml",
    "https://www.defensenews.com/arc/outboundfeeds/rss/category/pentagon/?outputType=xml",
    "https://www.defensenews.com/arc/outboundfeeds/rss/category/space/?outputType=xml",
    "https://www.defensenews.com/arc/outboundfeeds/rss/category/unmanned/?outputType=xml",
    "https://www.militarytimes.com/arc/outboundfeeds/rss/category/news/pentagon-congress/?outputType=xml",
    "https://www.c4isrnet.com/arc/outboundfeeds/rss/category/artificial-intelligence/?outputType=xml",
    "https://theconversation.com/us/articles.atom",
    "https://www.sciencenews.org/feed",
    "https://www.c4isrnet.com/arc/outboundfeeds/rss/category/unmanned/?outputType=xml",
    "https://www.c4isrnet.com/arc/outboundfeeds/rss/category/information-warfare/?outputType=xml",
    "https://www.c4isrnet.com/arc/outboundfeeds/rss/category/battlefield-tech/?outputType=xml",
    "https://www.c4isrnet.com/arc/outboundfeeds/rss/category/cyber/?outputType=xml",
    "https://www.c4isrnet.com/arc/outboundfeeds/rss/category/artificial-intelligence/?outputType=xml",
    "https://warontherocks.com/category/podcasts/war-on-the-rocks/feed/",
    "https://www.technologyreview.com/feed/",
    "https://www.wired.com/feed/category/business/latest/rss",
    "https://www.wired.com/feed/tag/ai/latest/rss",
    "https://www.wired.com/feed/category/security/latest/rss",
    "https://www.wired.com/feed/category/science/latest/rss",
    "https://www.wired.com/feed/category/backchannel/latest/rss",
    "https://defensescoop.com/feed/",
    "https://aiscoop.com/feed/",
    "https://scitechdaily.com/feed/",
    "https://defensescoop.com/feed/",
    "https://cyberscoop.com/feed/",
    "https://www.popularmechanics.com/rss/all.xml/",
    "https://www.geekwire.com/science/feed/",
    "https://www.technewsworld.com/rss-feed",
    "https://www.geekwire.com/space/feed/",
    "https://arstechnica.com/feed/",
    "https://www.vice.com/en/feed/",
    "https://thecitizen.com/feed/",
    "https://www.techmeme.com/feed.xml",
    "https://techcrunch.com/feed/",
    "https://www.theverge.com/rss/index.xml",
    "https://spectrum.ieee.org/customfeeds/feed/all-topics/rss",
    "https://breakingdefense.com/full-rss-feed/?v=2",
    "https://feeds.feedburner.com/venturebeat/SZYF",
    "https://www.twz.com/feed",
    "https://nypost.com/feed/",
    "https://pagesix.com/feed/?_gl=1%2A11e7f5n%2A_ga%2AMjU0NDE4MzIxLjE3NTYwNjc3MTc.%2A_ga_0DZ7LHF5PZ%2AczE3NTYwNjc3MTYkbzEkZzEkdDE3NTYwNjc3MzIkajQ0JGwwJGgw",
    "https://www.newsmax.com/rss/Newsfront/16",
    "https://www.newsmax.com/rss/US/18/",
    "https://www.newsmax.com/rss/TheWire/118/",
    "https://www.newsmax.com/rss/SciTech/20/",
    "https://feeds.nbcnews.com/nbcnews/public/news",
    "https://www.theguardian.com/us/rss",
    "https://feeds.skynews.com/feeds/rss/us.xml",
    "https://feeds.skynews.com/feeds/rss/technology.xml",
    "https://feeds.skynews.com/feeds/rss/world.xml",
    "https://www.infoworld.com/news/feed/",
    "https://www.washingtontimes.com/rss/headlines/culture/technology/",
    "https://www.washingtontimes.com/rss/headlines/news/national/",
    "https://www.washingtontimes.com/rss/headlines/news/world/",
    "https://www.washingtontimes.com/rss/headlines/news/security/",
]
tech_keywords = [
    "fbi",
    "cia",
    "dod",
    "doj",
    "doi",
    "nsa",
    "hsa",
    "hot",
    "potus",
    "scotus",
    "america",
    "american",
    "united",
    "house",
    "college",
    "graduate",
    "graduated",
    "promote",
    "promoted",
    "promotion",
    "appoint",
    "appointment",
    "appointee",
    "appointments",
    "states",
    "state",
    "invent",
    "inventor",
    "invented",
    "invention",
    "brilliant",
    "public",
    "private",
    "cloud",
    "infrastructure",
    "grid",
    "electric",
    "electrical",
    "electricity",
    "ai",
    "ml",
    "llm",
    "vr",
    "ar",
    "ufo",
    "extraterrestrial",
    "orbit",
    "orbiting",
    "orbits",
    "flying",
    "fly",
    "object",
    "source",
    "open",
    "open-source",
    "department",
    "branch",
    "collection",
    "collections",
    "archive",
    "monitor",
    "uap",
    "aerial",
    "unidentified",
    "phenomenon",
    "phenomena",
    "alien",
    "uav",
    "action",
    "bill",
    "passed",
    "remote",
    "satellite",
    "error",
    "cyber",
    "cybercrime",
    "fraud",
    "scam",
    "scammer",
    "scammed",
    "scamming",
    "ota",
    "caught",
    "catch",
    "global",
    "nuclear",
    "missile",
    "weapons",
    "weapon",
    "missiles",
    "launch",
    "launched",
    "launching",
    "launches",
    "power",
    "powerful",
    "plane",
    "tank",
    "tanker",
    "tanks",
    "tankers",
    "oil",
    "rig",
    "rigs",
    "rigged",
    "vehicle",
    "carrier",
    "ship",
    "destroyer",
    "rocket",
    "explosion",
    "explosive",
    "explosives",
    "explosions",
    "collision",
    "impact",
    "mass",
    "destruction",
    "bomb",
    "bomber",
    "vessel",
    "vessels",
    "energy",
    "money",
    "deal",
    "buy",
    "sell",
    "sold",
    "confess",
    "guilty",
    "innocent",
    "warning",
    "threat",
    "threaten",
    "trigger",
    "law",
    "lawyer",
    "lawfyl",
    "construction",
    "construct",
    "constructed",
    "break",
    "broken",
    "violated",
    "subpoena",
    "issue",
    "court",
    "supreme",
    "high",
    "king",
    "prime",
    "minister",
    "seceretary",
    "communication",
    "satellites",
    "scan",
    "detected",
    "detect",
    "detective",
    "investigate",
    "investigator",
    "atomics",
    "anduril",
    "investigation",
    "committee",
    "congress",
    "mayor",
    "governor",
    "sheriff",
    "senator",
    "representative",
    "computer",
    "computers",
    "virus",
    "breach",
    "data",
    "hack",
    "hacker",
    "hacking",
    "programming",
    "program",
    "programmer",
    "programs",
    "join",
    "forces",
    "forced",
    "force",
    "dilemma",
    "tech",
    "technology",
    "technological",
    "technologic",
    "technologically",
    "technologies",
    "board",
    "mother",
    "component",
    "components",
    "company",
    "companies",
    "trust",
    "anti",
    "fund",
    "funding",
    "funded",
    "breached",
    "exploit",
    "exploits",
    "exploited",
    "blackmail",
    "leverage",
    "extort",
    "extortion",
    "peak",
    "climax",
    "tip",
    "anonymous",
    "witness",
    "testimony",
    "testament",
    "proof",
    "proved",
    "correct",
    "right",
    "wrong",
    "left",
    "north",
    "west",
    "east",
    "south",
    "idea",
    "legistlation",
    "constitution",
    "amendment",
    "rights",
    "first",
    "second",
    "third",
    "fourth",
    "fifth",
    "doctor",
    "medical",
    "simulation",
    "simulate",
    "simulated",
    "simulations",
    "flight",
    "expedition",
    "movement",
    "protest",
    "protests",
    "join",
    "unite",
    "software",
    "operation",
    "operations",
    "operating",
    "optic",
    "optics",
    "optical",
    "optimal",
    "optimize",
    "optimization",
    "training",
    "train",
    "valid",
    "validating",
    "validated",
    "benchmark",
    "silicon",
    "rare",
    "earth",
    "metals",
    "metal",
    "lithium",
    "gold",
    "silver",
    "copper",
    "kernel",
    "code",
    "python",
    "C",
    "C++",
    "C/C++",
    "coding",
    "system",
    "systems",
    "reveal",
    "revealing",
    "reveals",
    "revealed",
    "cybersecurity",
    "security",
    "dollar",
    "dollars",
    "whistle",
    "blow",
    "general",
    "colonel",
    "captain",
    "war",
    "attack",
    "officer",
    "soldier",
    "marine",
    "army",
    "navy",
    "air",
    "force",
    "space",
    "spacex",
    "nasa",
    "xai",
    "chat-gpt",
    "chatgpt",
    "gemini",
    "co-pilot",
    "copilot",
    "deepseek",
    "seek",
    "deep",
    "defense",
    "shield",
    "star",
    "stargate",
    "shield",
    "starshield",
    "starship",
    "starships",
    "national",
    "nation",
    "pentagon",
    "secret",
    "secrets",
    "token",
    "tokens",
    "tokenization",
    "processing",
    "processor",
    "chip",
    "semiconductor",
    "microchip",
    "chips",
    "microchips",
    "manufacture",
    "manufacturing",
    "industry",
    "hoax",
    "cruel",
    "critical",
    "crucial",
    "classify",
    "classified",
    "file",
    "files",
    "document",
    "documents",
    "reports",
    "paper",
    "papers",
    "research",
    "researched",
    "researcher",
    "command",
    "senate",
    "review",
    "reviewing",
    "reviews",
    "reviewer",
    "deputy",
    "deputize",
    "deputized",
    "fire",
    "fired",
    "coast",
    "guard",
    "guardian",
    "guarding",
    "win",
    "winning",
    "scandal",
    "blockchain",
    "quantum",
    "robotics",
    "transformer",
    "gpt",
    "chat",
    "language",
    "model",
    "large",
    "military",
    "unmanned",
    "drone",
    "drones",
    "swarm",
    "fleet",
    "platoon",
    "squad",
    "team",
    "lead",
    "leads",
    "leader",
    "leading",
    "cutting",
    "edge",
    "art",
    "leak",
    "leaked",
    "leaks",
    "leaker",
    "whistleblower",
    "blower",
    "android",
    "droid",
    "cable",
    "reception",
    "mobile",
    "home",
    "base",
    "basis",
    "based",
    "bases",
    "station",
    "stations",
    "site",
    "black",
    "sites",
    "website",
    "websites",
    "autonomous",
    "breakthrough",
    "million",
    "billion",
    "trillion",
    "machine",
    "deep",
    "algorithm",
    "learning",
    "arrested",
    "arrest",
    "arrests",
    "multiple",
    "media",
    "social",
    "disaster",
    "security",
    "risk",
    "danger",
    "warfare",
    "advanced",
    "artificial",
    "intelligence",
    "advancement",
    "discover",
    "discovery",
    "discovered",
    "scientist",
    "test",
    "tests",
    "testing",
    "tested",
    "experiment",
    "experimenting",
    "experiments",
    "experimented",
    "human",
    "humanity",
    "result",
    "seals",
    "sealed",
    "indictment",
    "warrant",
    "results",
    "streamer",
    "youtuber",
    "director",
    "president",
    "auto",
    "robot",
    "bot",
    "agent",
    "succeed",
    "succeeded",
    "succeeds",
    "success",
    "fail",
    "failed",
    "fails",
    "failure",
    "expose",
    "exposed",
    "info",
    "information",
    "office",
    "justice",
    "homeland",
    "chief",
    "judge",
    "jury",
    "trial",
    "content",
    "creator",
    "developer",
    "development",
    "updated",
    "develop",
    "create",
    "created",
    "developed",
    "creates",
    "develops",
    "engineer",
    "engineering",
    "spear",
    "head",
    "top",
    "chair",
    "chairman",
    "spy",
    "spied",
    "spying",
    "espionage",
    "deploy",
    "deployment",
    "deployed",
    "airspace",
    "fighters",
    "fight",
    "fighter",
    "arsenal",
    "armory",
    "treasury",
    "targeting",
    "target",
    "helicopter",
    "airlift",
    "armys",
    "navys",
    "post",
    "troops",
    "squadron",
    "wing",
    "targeted",
    "targets",
    "reserve",
    "reservation",
    "reserved",
    "reservations",
    "sea",
    "boat",
    "ocean",
    "city",
    "country",
    "province",
    "locations",
    "location",
    "geography",
    "geopolitical",
    "strategy",
    "strategic",
    "stategies",
    "laser",
    "plasma",
    "secretive",
    "CEO",
    "computing",
    "computation",
    "aienabled",
    "enable",
    "enabled",
    "enabling",
    "disabled",
    "disable",
    "math",
    "mathematics",
    "mathematician",
    "anomaly",
    "mission",
    "ops",
    "psyops",
    "op",
    "psyop",
    "delta",
    "deadline",
    "stats",
    "stat",
    "statistic",
    "statistics",
    "statistically",
    "percent",
    "percentage",
    "population",
    "report",
    "findings",
    "finding",
    "found",
    "cover",
    "covered",
    "covers",
    "land",
    "landed",
    "landing",
    "craft",
    "aircraft",
    "underwater",
    "water",
    "submarine",
    "spacecraft",
    "network",
    "networks",
    "networking",
    "internet",
    "web",
    "server",
    "servers",
    "webserver",
    "webservers",
    "save",
    "saved",
    "saving",
    "storage",
    "complex",
    "framework",
    "plan",
    "planning",
    "planned",
    "plans",
    "planner",
    "gun",
    "ammo",
    "ammunition",
    "teach",
    "teaches",
    "taught",
    "teacher",
    "professor",
    "university",
    "school",
    "subject",
    "student",
    "provider",
    "provide",
    "provides",
    "provided",
    "antiair",
    "surveillance",
    "camera",
    "record",
    "recording",
    "records",
    "recorded",
    "outer",
    "asteroid",
    "comet",
    "scientists",
    "raid",
]

if __name__ == "__main__":
    start = time.time()
    try:
        nltk.data.find("tokenizers/punkt")
        nltk.data.find("corpora/stopwords")
    except LookupError:
        nltk.download("punkt")
        nltk.download("punkt_tab")
        nltk.download("stopwords")
    # for url in soups_urls:
    #     soup_crawl(url)
    init_db()
    curate_tech_news(rss_urls, tech_keywords)
    print(f"{time.time() - start}", "curate time")
    res = show_top_articles()
    print(res.fetchmany(size=10))
    # for i, r in enumerate(res):
    #     imgs = []
    #     print(r)
    # r["post_text"] = generate_post_text(r["summary"], config["genai_key"])
    # print(r["post_text"])
    # res_img = download_image(r["img"], filename=f"./imgs/res{i}.jpg")
    # if res_img:
    #     imgs.append(res_img)
    # try:
    #     img_paths = google_image_search(
    #         config["google_img_search"], config["cse_cx"], r["keywords"]
    #     )
    #     imgs = imgs + img_paths
    # except Exception as e:
    #     print(f"{e}")
    # try:
    #     img_urls = search_image_pixabay(r["keywords"], config['pixabay_api_key'])
    #     if img_urls:
    #         url_img = download_image(img_urls, filename=f"./imgs/pixabay.jpg")
    #         imgs.append(url_img)
    # except Exception as e:
    #     print(f"{e}")
    # for path in imgs:
    #     if path:
    #         fig, ax = plt.subplots(layout="tight")
    #         image = plt.imread(path)
    #         ax_img = ax.imshow(image)
    #         left, right, bottom, top = ax_img.get_extent()
    #         ax.text(0, 0 - (2*(bottom / 40)), r["post_text"], fontsize=10, wrap=True)
    #         ax.text(0, 0 - ((bottom / 40)), r["url"], fontsize=10, wrap=True)
    #         ax.text(0, 0, r["keywords"], fontsize=10, wrap=True)
    #         plt.show()
    # top_r.append(r)

    # while(count < 5):
    #     res = crawl_tech_news()
    #     top = curate_articles(res)
    #     print(top)
    #     # send_approval_email(top, 'imsladx@gmail.com')
    #
    #     post=top[0]['title']
    #
    #     time.sleep(300)
